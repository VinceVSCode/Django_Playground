{% extends "firstsite/base.html" %}
{% block title %}Analytics{% endblock %}

{% block content %}
<div class="card">
  <h2 style="margin-top:0;">Notes Analytics</h2>

  <form method="get" class="filter-bar" style="display:flex; gap:1rem; flex-wrap:wrap; align-items:end;">
    <div>
      <label for="bucket"><strong>Bucket</strong></label><br>
      <select name="bucket" id="bucket">
        {% for b in all_buckets %}
          <option value="{{ b }}" {% if b == bucket %}selected{% endif %}>{{ b|capfirst }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label><strong>Actions</strong></label><br>
      {% for a in all_actions %}
        <label style="margin-right:.5rem;">
          <input type="checkbox" name="actions" value="{{ a }}" {% if a in actions %}checked{% endif %}>
          {{ a|capfirst }}
        </label>
      {% endfor %}
    </div>

    <div>
      <button class="button" type="submit">Apply</button>
      <a class="button" href="{% url 'analytics' %}">Reset</a>
    </div>
  </form>
</div>

{% if not table_rows %}
  <div class="card" style="text-align:center;">
    <p class="muted">No events yet for the chosen filters.</p>
  </div>
{% else %}
  <div class="card">
    <h3 style="margin-top:0;">{{ bucket|capfirst }} totals</h3>
    <div style="overflow-x:auto;">
      <table class="analytics-table">
  <thead>
    <tr>
      <th>Period</th>
      {% for a in actions %}
        <th>{{ a|capfirst }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for row in table_rows %}
      <tr>
        <td><strong>{{ row.period }}</strong></td>
        {% for val in row.counts %}
          {% if val %}
            <td>
              <div class="analytics-bar" style="width: calc(240px * {{ val }} / {{ max_val }});"></div>
              <span class="analytics-bar-value">{{ val }}</span>
            </td>
          {% else %}
            <td><span class="analytics-bar-value">0</span></td>
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

    </div>
  </div>
{% endif %}
{% endblock %}
