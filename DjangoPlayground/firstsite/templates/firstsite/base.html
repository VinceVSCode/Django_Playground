{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Notes{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'firstsite/styles.css' %}" />
</head>
<body>
  <!-- unified topbar (uses classes defined in styles.css) -->
  <header class="topbar" aria-label="Site header">
    <div class="topbar__left">
      <!-- Placeholder for a future logo -->
      <div class="logo-slot" aria-label="App Logo Placeholder"></div>

      <!-- Primary nav -->
      <nav class="topbar__nav" aria-label="Main navigation">
        {% if request.user.is_authenticated %}
          <a href="{% url 'note_lists' %}" class="topbar__link">Notes</a>
          <a href="{% url 'create_note' %}" class="topbar__link">New note</a>
          <a href="{% url 'analytics' %}" class="topbar__link">Analytics</a>
          <a href="{% url 'inbox' %}" class="topbar__link">Inbox</a>
          <a href="{% url 'sent' %}" class="topbar__link">Sent</a>
        {% endif %}
      </nav>
    </div>

    <div class="topbar__right">
      {% if request.user.is_authenticated %}
        <span class="topbar__user">Logged in as {{ request.user.username }}</span>

        <!-- Theme toggle button -->
        <button id="themeToggle" class="button button--icon" type="button" aria-pressed="false">Light mode</button>


        <form action="{% url 'logout' %}" method="post" class="inline" style="margin:0;">
          {% csrf_token %}
          <button class="button" type="submit">Logout</button>
        </form>
      {% else %}
        <!-- Theme toggle is available even when logged out -->
        <button id="themeToggle" class="button button--icon" type="button" aria-pressed="false">Light mode</button>

        <a href="{% url 'login' %}" class="topbar__link">Login</a>
      {% endif %}
    </div>
  </header>

  <!-- Flash messages (now styled using .card) -->
  {% if messages %}
    <div class="page" role="status" aria-live="polite" style="padding-top:.75rem;">
      {% for message in messages %}
        <div class="card" style="margin-bottom:.5rem;">
          <p class="muted">{{ message }}</p>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main page wrapper (uses .page from styles.css) -->
  <main class="page">
    {% block content %}{% endblock %}
  </main>
  <script>
    (function(){
      // SVGs for the action the button will perform
      var ICON_YELLOW = '<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#f5d90a" d="M9 21h6v-1H9v1Zm3-19a7 7 0 0 0-4.9 11.9c.4.4.9 1.1.9 1.6V16h8v-.5c0-.6.5-1.2.9-1.6A7 7 0 0 0 12 2Zm3.5 12H8.5c-.1-.6-.5-1.3-1-1.8A5.5 5.5 0 1 1 16.5 12c-.5.5-.9 1.2-1 2Z"/></svg>';
      var ICON_GRAY   = '<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#111316" d="M9 21h6v-1H9v1Zm3-19a7 7 0 0 0-4.9 11.9c.4.4.9 1.1.9 1.6V16h8v-.5c0-.6.5-1.2.9-1.6A7 7 0 0 0 12 2Zm3.5 12H8.5c-.1-.6-.5-1.3-1-1.8A5.5 5.5 0 1 1 16.5 12c-.5.5-.9 1.2-1 2Z"/></svg>';

      // 1) Initialize theme from localStorage or system preference
      var saved = localStorage.getItem('theme'); // "light" | "dark" | null
      var prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var theme = saved || (prefersLight ? 'light' : 'dark');
      document.documentElement.setAttribute('data-theme', theme);

      // 2) Update button label + icon to indicate the NEXT action
      function setButtonUI(btn, currentTheme) {
        var next = (currentTheme === 'light') ? 'dark' : 'light';
        var icon = (next === 'light') ? ICON_YELLOW : ICON_GRAY;   // yellow when going to light, gray when going to dark
        btn.innerHTML = icon + (next === 'light' ? ' Light mode' : ' Dark mode');
        btn.setAttribute('aria-pressed', currentTheme === 'light' ? 'true' : 'false');
      }

      var btn = document.getElementById('themeToggle');
      if (btn) {
        setButtonUI(btn, theme);
        btn.addEventListener('click', function(){
          var current = document.documentElement.getAttribute('data-theme') || 'dark';
          var next = (current === 'light') ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', next);
          localStorage.setItem('theme', next);
          setButtonUI(btn, next);
        });
      }
    })();
  </script>


</body>
</html>
