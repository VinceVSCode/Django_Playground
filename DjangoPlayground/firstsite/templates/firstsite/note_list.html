{% extends "firstsite/base.html" %}
{% block title %}Your Notes{% endblock %}

{% block content %}
<h1>Your Notes</h1>

<form method="get" style="margin-bottom:1rem">
  <input type="text" name="search" placeholder="Search…" value="{{ values.search|default:'' }}" />

  <select name="tag">
    <option value="">— All tags —</option>
    {% for t in tags %}
      <option value="{{ t.id }}" {% if values.tag == t.id|stringformat:"s" %}selected{% endif %}>{{ t.name }}</option>
    {% endfor %}
  </select>

  <label>
    <input type="checkbox" name="untagged" value="1" {% if values.untagged == '1' %}checked{% endif %}/>
    Untagged only
  </label>

  <label>
    Pinned:
    <select name="pinned">
      <option value="">All</option>
      <option value="1" {% if values.pinned == '1' %}selected{% endif %}>Yes</option>
      <option value="0" {% if values.pinned == '0' %}selected{% endif %}>No</option>
    </select>
  </label>

  <label>
    Archived:
    <select name="archived">
      <option value="">All</option>
      <option value="0" {% if values.archived == '0' %}selected{% endif %}>No</option>
      <option value="1" {% if values.archived == '1' %}selected{% endif %}>Yes</option>
    </select>
  </label>

  <button type="submit">Apply</button>
  <a href="{% url 'note_lists' %}">Reset</a>
</form>

{% if page_obj.object_list %}
  <ul>
    {% for note in page_obj.object_list %}
      <li class="card">
        <strong>
          <a href="{% url 'note_detail' note.pk %}">{{ note.title }}</a>
        </strong>
        {% if note.is_pinned %}<em> (Pinned)</em>{% endif %}
        {% if note.is_archived %}<em> (Archived)</em>{% endif %}
        <div class="muted">{{ note.content|truncatechars:120 }}</div>
        {% if note.tags.exists %}
          <div>
            <small>Tags:
              {% for tag in note.tags.all %}
                {{ tag.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </small>
          </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  {# --- numbered pager goes here (next step) --- #}
{% if page_obj.paginator.num_pages > 1 %}
  <nav class="pagination">
    {# First / Prev #}
    {% if page_obj.has_previous %}
      <a class="button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">« First</a>
      <a class="button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">‹ Prev</a>
    {% endif %}

    {# Windowed page numbers with ellipses (no parentheses in conditions) #}
    {% for num in page_obj.paginator.page_range %}
      {% if num == 1 or num == page_obj.paginator.num_pages or num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
        {% if num == page_obj.number %}
          <span class="button" style="font-weight:bold;">{{ num }}</span>
        {% else %}
          <a class="button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        {% endif %}
      {% elif num == page_obj.number|add:'-3' or num == page_obj.number|add:'3' %}
        <span class="muted">…</span>
      {% endif %}
    {% endfor %}

    {# Next / Last #}
    {% if page_obj.has_next %}
      <a class="button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next ›</a>
      <a class="button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.paginator.num_pages }}">Last »</a>
    {% endif %}
  </nav>
{% endif %}


{% else %}
  <p>No notes match your filters.</p>
{% endif %}

{% endblock %}
